<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-02-20 Thu 10:39 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pynasqm</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="dustin" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Pynasqm</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgafa84d2">1. Installation</a></li>
<li><a href="#orgd893595">2. Usage</a></li>
<li><a href="#orge6b3b73">3. SANDER-NEXMD</a>
<ul>
<li><a href="#orgc159a04">3.1. Installation</a></li>
<li><a href="#org5f6f868">3.2. SANDER-NEXMD Single Trajectory Run</a></li>
<li><a href="#org936692c">3.3. AMBER Coordinate File</a></li>
<li><a href="#orgdfebdd8">3.4. AMBER prmtop</a></li>
<li><a href="#org6136e2d">3.5. Creating a QM/MM System for SANDER-NEXMD&#xa0;&#xa0;&#xa0;<span class="tag"><span class="METHOD">METHOD</span></span></a></li>
</ul>
</li>
<li><a href="#org486fecc">4. Pytraj</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgafa84d2" class="outline-2">
<h2 id="orgafa84d2"><span class="section-number-2">1</span> Installation</h2>
<div class="outline-text-2" id="text-1">
<p>
PYNASQM requires the following prerequisites
</p>
<ul class="org-ul">
<li><a href="#orge6b3b73">3</a></li>
<li><a href="#org486fecc">4</a></li>
</ul>

<p>
Clone this repository to the directory of your choosing.
</p>
<pre class="example">
git clone https://github.com/PotentialParadox/pynasqm.git
cd pynasqm
python setup install
</pre>
</div>
</div>
<div id="outline-container-orgd893595" class="outline-2">
<h2 id="orgd893595"><span class="section-number-2">2</span> Usage</h2>
<div class="outline-text-2" id="text-2">
<p>
Pynasqm is currently capable of automating the following actions
</p>
<ul class="org-ul">
<li>Single MM-Ground State Trajectory</li>
<li>QM-Ground State Trajectories originating from MM-Ground-State</li>
<li>Absorption calculations using snapshots from the QM-Ground State Trajectories</li>
<li>PulsePump SinglePoint Calculations</li>
<li>QM-Excited State Trajectory
<ul class="org-ul">
<li>Franck-Condon Excitations</li>
<li>Pule Pump Simulations</li>
<li>Capable of performing Non-Adiabatic using the isTully option</li>
</ul></li>
</ul>


<div class="figure">
<p><img src="images/trajectories.png" alt="trajectories.png" />
</p>
</div>


<p>
Follow instructions for Creating a QM/MM System for SANDER-NEXMD to create an
AMBER parameter/topology (prmtop) file and an AMBER coordinate (inpcrd) file.
Create a new directory with any name you'd like.
Copy your prmtop and inpcrd file to that directory, renaming the files to 
</p>
<ul class="org-ul">
<li>m1.prmtop (prmtop file)</li>
<li>m1<sub>md2.rst</sub> (restart file)</li>
</ul>
<p>
You can initialize the other input files with
</p>
<pre class="example">
nasqm.py --init
</pre>
<p>
which will generate
</p>
<ul class="org-ul">
<li>pynasqm.in (pynasqm input file)</li>
<li>input.ceon (The NEXMD input file)</li>
<li>md<sub>qmmm</sub><sub>amb.in</sub> (The AMBER input file)</li>
</ul>

<p>
For the documentation for NEXMD, please refer to <a href="https://github.com/roitberg/nexmd">NEXMD-Git</a> (Contact either
Adrian Roitberg (roitberg@ufl.edu) or Sergei Tretiak (serg@lanl.gov) for
permission). For the AMBER input file, refer to <a href="https://ambermd.org/doc12/Amber19.pdf">AMBER-Manual</a>. 
</p>

<p>
The pynasqm input file is written as a commented J-SON file. On lines other than the ones
commented out, the file is white space sensitive. Any edits should be performed
within the second quoted value on the line. Refer to the comments within the
file for guidance on the inputs. Any further question can be referred to Dustin
Tracy (dtracy@ufl.edu).
systems employing the slurm array feature.
</p>

<p>
Once your input files are setup, run the program by executing the following in
your working directory containing the input files.
</p>
<pre class="example">
nasqm.py
</pre>
</div>
</div>

<div id="outline-container-orge6b3b73" class="outline-2">
<h2 id="orge6b3b73"><span class="section-number-2">3</span> SANDER-NEXMD</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgc159a04" class="outline-3">
<h3 id="orgc159a04"><span class="section-number-3">3.1</span> Installation</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Installation of the SANDER-NEXMD installation will require the following as well
as their dependencies:
</p>

<ul class="org-ul">
<li>NEXMD (Git Access)</li>
<li>Amber (Git Access)</li>
</ul>

<p>
We also strongly encourage the use of the intel/2017 compiler w/ mkl. GNU is
supported but users will have better performance with the intel compiler.
</p>

<p>
First install NEXMD. Access to the NEXMD git is restricted. Please contact
either Adrian Roitberg (roitberg@ufl.edu) or Sergei Tretiak (serg@lanl.gov) for
permission.
</p>

<p>
CD to your application director, then pull the NEXMD git using. 
</p>

<pre class="example">
git clone https://github.com/roitberg/nexmd.git
</pre>


<p>
And check-in to the amber-nexmd-na branch.
</p>

<pre class="example">
cd nexmd 
git checkout amber-nexmd-na 
</pre>

<p>
Try to install the standalone NEXMD program. Activate your chosen compiler, then use either: 
</p>

<pre class="example">
make ic_mkl # For intel w/ mkl 
make gnu_mkl # For gnu w/ mkl 
make gnu # For gnu wo/ mkl (not recommended) 
</pre>

<p>
If this fails, refer to the documentation included in the NEXMD git. Please contact either Dustin Tracy (dtracy@ufl.edu) or Benjamin Nebgen (bnebgen@lanl.gov) for further questions regarding compilation of NEXMD. Once we’ve successfully installed NEXMD, we need to flush the standalone temp files so AMBER can build the Library files. 
</p>

<pre class="example">
make clean 
</pre>

<p>
Now we need to set a variable so AMBER knows where to find NEXMD. 
</p>

<pre class="example">
export NAESMDHOME=`pwd` 
</pre>

<p>
Note that currently NAESMDHOME is used here, not NEXMDHOME. The new name will be
updated soon. We are now done with prepping NEXMD.
</p>

<p>
We now need to install AMBERTOOLS. We are currently using a restricted git for
development. Please contact Dustin Tracy (dtracy@ufl.edu) for access to a tar
file.
</p>

<p>
CD into your application directory and extract the tar file. 
</p>

<pre class="example">
tar -xvf amber_na.tar.gz 
</pre>

<p>
Try to build the standalone AMBER program.  
</p>

<pre class="example">
cd amber 
export AMBERHOME=`pwd` 

./configure –noX11 --skip-python -norism  intel mkl # for intel  w/ mkl 

./configure –noX11 --skip-python -norism  gnu mkl # for gnu  w/ mkl 

./configure –noX11 --skip-python -norism  gnu # for gnu 
</pre>

<p>
Use the same configuration you used for your NEXMD build. 
</p>

<p>
Then install 
</p>

<pre class="example">
source ./amber.sh 

make install 
</pre>

<p>
If this fails please refer to the amber manual (<a href="https://ambermd.org/Manuals.php">https://ambermd.org/Manuals.php</a>)
for troubleshooting and contact information. Once successful installation and
testing of the standalone AmberTools packages is completed cd back into
AMBERHOME and configure AMBER to link to the NEXMD package.
</p>

<pre class="example">
cd $AMBERHOME 

./configure –noX11 --skip-python -norism -naesmd intel mkl # for intel  w/ mkl 

./configure –noX11 --skip-python -norism -naesmd gnu mkl # for gnu  w/ mkl 

./configure –noX11 --skip-python -norism -naesmd gnu # for gnu 
</pre>

<p>
We don’t need to rebuild all AMBER now, only SANDER, so we CD into SANDER and build from there. 
</p>

<pre class="example">
cd AmberTools/src/sander 

make install 
</pre>

<p>
To test successful installation (python3 required) 
</p>

<pre class="example">
cd $NAESMDHOME/testscripts/amber_nexmd_testscripts 

python run_tests.py 
</pre>
</div>
</div>

<div id="outline-container-org5f6f868" class="outline-3">
<h3 id="org5f6f868"><span class="section-number-3">3.2</span> SANDER-NEXMD Single Trajectory Run</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Though our implementation of the simulation of non-adiabatic dynamics requires a
large number of independent trajectories, the SANDER-NEXMD interface can only
manage a single trajectory. Another script (to be introduced later) controls the
characteristics of the swarm. Each single SANDER-NEXMD trajectory will require a
number of inputs.
</p>

<ul class="org-ul">
<li>Amber Input (mdin)</li>

<li>NEXMD Input (input.ceon)</li>

<li>Amber Coordinate File (mdcrd)</li>

<li>Amber Parameter File (prmtop)</li>
</ul>

<p>
Full examples can be found in $NAESMDHOME/tests/amber<sub>nexmd</sub>/. Refer to the the
included README in that directory to determine the type of trajectory for each
test.
</p>

<p>
Amber Input 
</p>

<pre class="example">
300K constant temp QMMMMD 
 &amp;cntrl 
  ** Normal Amber Input (Check manual) ** 
  ifqnt=1 
 / 

 &amp;qmmm 
  verbosity=5, 
  qmmask=':1', 
  nae=1 
 / 
</pre>

<p>
No special behavior is needed from cntrl besides the activation of qm/mm (setting ifqnt=1). Most QM/MM behavior is controlled by the input.ceon file for the exception of the verbosity, the atoms the include in the qm calculations (qmmask) and the referral to nexmd (nae). Please refer the AMBER manual for information regarding the parameters found in &amp;cntrl. 
</p>

<p>
NEXMD Input 
</p>

<pre class="example">
&amp;qmmm 
  maxcyc=0, ! Optimization must be turned off
 ** Normal NEXMD Input **  
 ** Include all of AMBER’s qm/mm flags besides verbosity, qmmask ** 
&amp;endqmmm 

&amp;moldyn 
  ** Normal NEXMD Input ** 
&amp;endmoldyn 
&amp;coord 
  ** Block must be included but is ignored ** 
&amp;endcoord 
&amp;veloc 
  ** Block must be included but is ignored ** 
&amp;endveloc 
&amp;coeff 
  ** Normal NEXMD Input ** 
&amp;endcoeff 
</pre>

<p>
The NEXMD-SANDER interface is designed to be able to read an unmodified nexmd
file. For most users, little to no modification will be required beyond setting
the qmewald parameters. Note that the initial coordinates and velocities are
read from the amber intput files and any values included in the input.ceon file
will be ignored.
</p>
</div>
</div>

<div id="outline-container-org936692c" class="outline-3">
<h3 id="org936692c"><span class="section-number-3">3.3</span> AMBER Coordinate File</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Amber coordinate files are needed to run the SANDER-NEXMD interface. These can
be created using tleap, or through a converter built into PyNASQM. To use the
pynasqm converter
</p>

<pre class="example">
amber-nexmd-converter.py input.ceon mdcrd
</pre>

<p>
Further instruction for prepping a job can be found in the Creating a System
section.
</p>
</div>
</div>

<div id="outline-container-orgdfebdd8" class="outline-3">
<h3 id="orgdfebdd8"><span class="section-number-3">3.4</span> AMBER prmtop</h3>
<div class="outline-text-3" id="text-3-4">
<p>
AMBER prmtop files can be generated using tleap. Refer to the AMBER manual for
this procedure or look at the Create a QM/MM System for SANDER-NEXMD.
</p>
</div>
</div>

<div id="outline-container-org6136e2d" class="outline-3">
<h3 id="org6136e2d"><span class="section-number-3">3.5</span> Creating a QM/MM System for SANDER-NEXMD&#xa0;&#xa0;&#xa0;<span class="tag"><span class="METHOD">METHOD</span></span></h3>
<div class="outline-text-3" id="text-3-5">
<ol class="org-ol">
<li>Build your solute using either Avogadro or Gaussview</li>
<li>Create pepi files for each using antechamber that came with AMBER for each of
the following commands <code>$molecule=molecule name</code></li>
<li>Generate your mol and frcmod files. There are two methods.
<ol class="org-ol">
<li><p>
If you have fully parameterized pdb file or don't need accurate charges.
(Most likely your main solute)
</p>
<pre class="example">
# Generates a prepfile
antechamber -fi pdb -fo prepi -i $molecule.pdb -o o2.prepi
# Generate frcmod file
parmchk2 -f prepi -i $molecule.prepi -o $molecule.frcmod 
# Generate mol2 file
antechamber -fi pdb -fo mol2 -i $molecule.pdb -o $molecule.mol2 -rn $molecule -c bcc -pf y 
</pre></li>
<li><p>
If you need accurate charges (Most likely a self generated solvent)
</p>
<div class="org-src-container">
<pre class="src src-shell-script"><span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Create a gaussian file to calculate resp charges</span>
antechamber -i $<span style="color: #715ab1;">molecule</span>.pdb <span style="color: #2d9574;">\</span>
            -fi pdb <span style="color: #2d9574;">\</span>
            -o $<span style="color: #3a81c3;">{</span><span style="color: #715ab1;">molecule</span><span style="color: #3a81c3;">}</span>_char.com <span style="color: #2d9574;">\</span>
            -fo gcrt <span style="color: #2d9574;">\</span>
            -gv <span style="color: #4e3163;">1</span> <span style="color: #2d9574;">\</span>
            -ge $<span style="color: #715ab1;">molecule</span>.gesp
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Run the gaussian file</span>
g09 $<span style="color: #3a81c3;">{</span><span style="color: #715ab1;">molecule</span><span style="color: #3a81c3;">}</span>_char.com &gt; $<span style="color: #3a81c3;">{</span><span style="color: #715ab1;">molecule</span><span style="color: #3a81c3;">}</span>_char.log
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Use the generated esp file to create mol2</span>
antechamber -i $<span style="color: #715ab1;">molecule</span>.esp <span style="color: #2d9574;">\</span>
            -fi gesp <span style="color: #2d9574;">\</span>
            -o $<span style="color: #715ab1;">molecule</span>.mol2 <span style="color: #2d9574;">\</span>
            -fo mol2 <span style="color: #2d9574;">\</span>
            -c resp <span style="color: #2d9574;">\</span>
            -eq <span style="color: #4e3163;">0</span> <span style="color: #2d9574;">\</span>
            -a gaff <span style="color: #2d9574;">\</span>
            -rn $<span style="color: #715ab1;">molecule</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Use mol2 file to generate frcmod</span>
parmchk -i $<span style="color: #715ab1;">molecule</span>.mol2 -f mol2 -o m1.frcmod
</pre>
</div></li>
</ol></li>

<li><p>
run tleap with
</p>
<pre class="example">
cat &lt;&lt; EOF &gt; leap.in
source leaprc.gaff
source leaprc.water.tip3p
loadamberparams $solute.frcmod
loadamberparams $solution.frcmod
$solute=loadmol2 $solute.mol2
$solution=loadmol2 $solution.mol2
solvatebox $solute $solution 30
saveamberparm $solute $solute.prmtop $solute.inpcrd
quit
EOF
tleap -f leap.in
</pre>
<p>
Note that the line <code>solvatebox $solute $solution 30</code> is the size of the
 box, you can change this to anything but the system will crash if the box
 isn't twice the length of the QM box.
</p></li>
<li><p>
You should now have the following 2 files. A parameter files <code>$solute.prmtop</code>
and <code>$solute.inpcrd</code>. We now want to equilibrate this system. Create the
following files
</p>
<pre class="example">
m1_min1.in
</pre>

<pre class="example">
initial minimization solvent + ions
&amp;cntrl
  imin   = 1,
  maxcyc = 1000,
  ncyc   = 500,
  ntb    = 1,
  ntr    = 1,
  cut    = 10.0
/
Hold Solute fixed
500.0
ATM 1 &lt;number of solute atoms&gt;
END
END
</pre>
<p>
Note : The line <code>ATM 1 &lt;number of solute atoms&gt;</code> should be from 1 to Number of atoms in solute.
</p>

<pre class="example">
m1_min2.in
</pre>

<pre class="example">
initial minimization solvent + ions
&amp;cntrl
  imin   = 1,
  maxcyc = 2500,
  ncyc   = 1000,
  ntb    = 1,
  ntr    = 0,
  cut    = 10.0
/
</pre>

<pre class="example">
m1_md1.in
</pre>

<pre class="example">
MD Equilibration STEP
&amp;cntrl
  imin   = 0,
  irest  = 0,
  ntx    = 1,
  ig     =-1,
  ntb    = 1,
  cut    = 10.0,
  ntr    = 1,
  ntc    = 2,
  ntf    = 2,
  tempi  = 0.0,
  temp0  = 300.0,
  ntt    = 3,
  gamma_ln = 2.0,
  nstlim = 5000, 
  dt = 0.002,
  ntpr = 100,
  ntwx = 100,
  ntwr = 1000
/
Keep fixed with weak restraints
10.0
ATM 1 &lt;number of solute atoms&gt;
END
END
</pre>
<p>
Note : The line <code>ATM 1 &lt;number of solute atoms&gt;</code> should be from 1 to Number of atoms in solute.
</p>

<pre class="example">
m_md2.in
</pre>

<pre class="example">
Constant Pressure Relaxation
&amp;cntrl
  imin = 0, 
  irest = 1,
  ntx = 5,
  ntb = 2,
  pres0 = 1.0,
  ntp = 1,
  ig = -1,
  taup = 2.0,
  cut = 10.0,
  ntr = 0,
  ntc = 2,
  ntf = 2,
  tempi = 300.0,
  temp0 = 300.0,
  ntt = 3,
  gamma_ln = 2.0,
  nstlim = 100000,
  dt = 0.002,
  ntpr = 100,
  ntwx = 100,
  ntwv = -1,
  ntwr = 1000
/
</pre></li>
<li><p>
Now we want to create our equilibrated system create a file
</p>
<pre class="example">
box_eq.sh
</pre>

<pre class="example">
echo 'm1_min'
sander -O -i m1_min.in -o m1_min.out -r m1_min.rst -c m1.inpcrd -p m1.prmtop -ref m1.inpcrd
echo 'm1_min1'
sander -O -i m1_min2.in -o m1_min2.out -r m1_min2.rst -c m1_min.rst -p m1.prmtop
echo 'm1_md1'
sander -O -i m1_md1.in -o m1_md1.out -r m1_md1.rst -c m1_min2.rst -p m1.prmtop -ref m1_min2.rst
echo 'm1_md2'
sander -O -i m1_md2.in -o m1_md2.out -r m1_md2.rst -c m1_md1.rst -p m1.prmtop
echo 'finished'
</pre></li>
<li><p>
Run this with
</p>
<pre class="example">
./box_eq.sh
</pre>
<p>
This will leave you with an equilibrated geometry file <code>m1_md2.rst</code>.
</p></li>
<li><p>
We now only need the NEXMD input and SANDER input file to begin. 
</p>
<pre class="example">
md_qmmm_amb.in
</pre>

<pre class="example">
300K constant temp QMMMMD
&amp;cntrl
  imin=0,
  iwrap=1,
  irest=0,
  ntx=5,
  ntb=1,
  ntp=0,
  ig=-1,
  taup=2.0,
  cut=16.0,
  ntr=0,
  tempi=300.0,
  temp0=300.0,
  ntt=3, ! Use Langevin
  gamma_ln=2.0, ! Lavenvin constant
  nstlim=20000, ! Number of Step
  dt=0.0005,
  ntpr=10, ! print every 10 steps
  ntwx=10, ! print coords every 10 steps
  ntwv=-1, ! save velocities every time coords are saved
  ifqnt=1 ! Do QM calculations
/
&amp;qmmm
  verbosity=1,
  qmmask=':1', ! Only use QM on the solute
  nae=1 ! Activate NEXMD Looks for input.ceon file
/
</pre>
<pre class="example">
input.ceon
</pre>

<pre class="example">
&amp;qmmm
  qm_theory='AM1',
  diag_routine=1,
  qmcharge=0,
  qmshake=0,
  qm_ewald=0,
  qm_pme=0,
  scfconv=1.0000E-10,
  printcharges=1,
  printdipole=0,
  printbondorders=0,
  density_predict=0,
  itrmax=300,
  diag_routine=1,
  exst_method=2,
  dav_guess=0,
  ftol0=1.0000E-05, ! Acceptance Tolerance for Davidson (emin-eold)
  ftol1=1.0000E-06, ! Acceptance Tolerance for Davidson (residual)
  dav_maxcyc=200,
  calcxdens=.false.,
  maxcyc=0,
  ntpr=1,
  grms_tol=1.0000E-02,
  solvent_model=0,
  potential_type=1,
  ceps=10,
  linmixparam=1,
  cosmo_scf_ftol=1.0000E-05,
  EF=0,
  Ex=0.0000E+00,
  Ez=0.0000E+00, 
  Ey=0.0000E+00,  !1.000E-02
  onsager_radius=2,
&amp;endqmmm
&amp;moldyn
  !***** General parameters
  rnd_seed=1, ! seed for the random number generator
  bo_dynamics_flag=1, ! 0-non-BO, 1-BO [1]
  exc_state_init=0, ! initial excited state (0 - ground state) [0]
  n_exc_states_propagate=0, ! number of excited states [0]

  !***** Dynamics parameters
  time_init=0.d0, ! initial time, fs [0.0]
  time_step=0.5, !time step, fs [0.1]
  n_class_steps=0, !number of classical steps [1]
  n_quant_steps=0, ! number of quantum steps for each classical step [4]
  moldyn_deriv_flag=1, ! 0-none, 1-analyt, 2-numeric [1]
  num_deriv_step=1.d-5, ! displacement for numerical derivatives, A [1.d-3]
  rk_tolerance=1.d-7, ! tolerance for the Runge-Kutta propagator [1.d-7]

  !***** Non-adiabatic parameters
  quant_step_reduction_factor=2.5d-2, ! quantum step reduction factor [0.1]
  decoher_type=2, ! type of decoherence: Persico/Granucci (0), Truhlar(1) [0]
  decoher_e0=0.d0, ! decoherence parameter E0 [0.1]
  decoher_c=0.d0, ! decoherence parameter C [0.1]
  dotrivial=1

  !***** Thermostat parameters
  therm_type=1, ! Thermostat type (0-no thermostat,1-Langevin,2-Berendsen) [0]
  therm_temperature=300.d0, ! Thermostate temperature, K [300.0]
  therm_friction=2.d0, ! thermostate friction coefficient, 1/ps [2.0]
  berendsen_relax_const=0.4d0, ! bath relaxation constant, only for Berendsen [0.4]
  heating=0, ! heating (1) or equilibrated(0) [0]
  heating_steps_per_degree=100, ! number of steps per degree during heating [100]

  !***** Output &amp; Log parameters
  verbosity=3, ! output verbosity (0-minimal, 3-highest) [2]
  out_data_steps=100, ! number of steps to write data [1]
  out_coords_steps=100, ! number of steps to write the restart file [10]
  out_data_cube=0, ! write(1) or not(0) view files to generate cubes [0]
  out_count_init=0, ! the initial count for output files [0]
&amp;endmoldyn

&amp;coord
&amp;endcoord

&amp;veloc
&amp;endveloc

&amp;coeff
      0.0000000000000000       0.0000000000000000
      0.0000000000000000       0.0000000000000000
&amp;endcoeff

</pre>

<p>
Note that the coord and veloc must be there, but there values will be
overridden by amber during dynamics.
</p></li>
<li><p>
Run the md with the command
</p>
<pre class="example">
sander -O -i md_qmmm_amb.in -o mdout -p m1.prmtop -c m1_md2.rst -x traj_file.nc
</pre></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org486fecc" class="outline-2">
<h2 id="org486fecc"><span class="section-number-2">4</span> Pytraj</h2>
<div class="outline-text-2" id="text-4">
<p>
<a href="https://amber-md.github.io/pytraj/latest/index.html">Pytraj</a> is a python program the wraps around cpptraj, a molecular dynamics
analyzer and editor. 
</p>

<p>
I've had a lot of issues using conda or pip to install pytraj. I found it best to build from source.
Make sure that you've activated your python environment, then
</p>
<pre class="example">
git clone https://github.com/Amber-MD/pytraj
cd pytraj
python ./setup.py install
</pre>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: dustin</p>
<p class="date">Created: 2020-02-20 Thu 10:39</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
