<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-04-15 Thu 12:34 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pynasqm</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Dustin Tracy" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Pynasqm</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org740d959">1. Installation</a></li>
<li><a href="#orgad3ddbd">2. Pytraj</a></li>
<li><a href="#orgde68d03">3. Usage</a>
<ul>
<li><a href="#org7565ba6">3.1. Capabilities</a></li>
<li><a href="#orgd4abf54">3.2. Initializing a System</a></li>
<li><a href="#org23a00cd">3.3. Plotting an Absorption Spectra</a></li>
<li><a href="#org5586498">3.4. Plotting Populations</a></li>
</ul>
</li>
<li><a href="#org2693876">4. Tutorials</a>
<ul>
<li><a href="#org33e2112">4.1. PPV3NO2 In Methanol. Absorption and Fluorescence</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org740d959" class="outline-2">
<h2 id="org740d959"><span class="section-number-2">1</span> Installation</h2>
<div class="outline-text-2" id="text-1">
<p>
PYNASQM requires the following prerequisites
-SANDER-NEXMD
</p>
<ul class="org-ul">
<li>Pytraj</li>
</ul>

<p>
Clone this repository to the directory of your choosing.
</p>
<pre class="example" id="org5e5e8a8">
git clone https://github.com/PotentialParadox/pynasqm.git
cd pynasqm
python setup install
</pre>
</div>
</div>
<div id="outline-container-orgad3ddbd" class="outline-2">
<h2 id="orgad3ddbd"><span class="section-number-2">2</span> Pytraj</h2>
<div class="outline-text-2" id="text-2">
<p>
<a href="https://amber-md.github.io/pytraj/latest/index.html">Pytraj</a> is a python program the wraps around cpptraj, a molecular dynamics
analyzer and editor. 
</p>

<p>
I've had a lot of issues using conda or pip to install pytraj. I found it best to build from source.
Make sure that you've activated your python environment, then
</p>
<pre class="example">
git clone https://github.com/Amber-MD/pytraj
cd pytraj
python ./setup.py install
</pre>
</div>
</div>
<div id="outline-container-orgde68d03" class="outline-2">
<h2 id="orgde68d03"><span class="section-number-2">3</span> Usage</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org7565ba6" class="outline-3">
<h3 id="org7565ba6"><span class="section-number-3">3.1</span> Capabilities</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Pynasqm is currently capable of automating the following actions using NEXMD and SANDER
</p>
<ul class="org-ul">
<li>Single MM-Ground State Trajectory</li>
<li>QM-Ground State Trajectories originating from MM-Ground-State</li>
<li>Absorption calculations using snapshots from the QM-Ground State Trajectories</li>
<li>QM-Excited State Trajectory</li>
<li>Non-Adiabatic using the Non-Adiabatic Dyanmics</li>
</ul>
</div>
</div>

<div id="outline-container-orgd4abf54" class="outline-3">
<h3 id="orgd4abf54"><span class="section-number-3">3.2</span> Initializing a System</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Follow instructions for Creating a QM/MM System for SANDER-NEXMD to create an
AMBER parameter/topology (prmtop) file and an AMBER coordinate (inpcrd) file.
Create a new directory with any name you'd like.
Copy your prmtop and inpcrd file to that directory, renaming the files to 
</p>
<ul class="org-ul">
<li>m1.prmtop (prmtop file)</li>
<li>m1<sub>md2.rst</sub> (restart file)</li>
</ul>
<p>
You can initialize the other input files with
</p>
<pre class="example" id="org303132f">
nasqm.py --init
</pre>
<p>
which will generate
</p>
<ul class="org-ul">
<li>pynasqm.in (pynasqm input file)</li>
<li>input.ceon (The NEXMD input file)</li>
<li>md<sub>qmmm</sub><sub>amb.in</sub> (The AMBER input file)</li>
</ul>

<p>
For the documentation for NEXMD, please refer to <a href="https://github.com/roitberg/nexmd">NEXMD-Git</a> (Contact either
Adrian Roitberg (roitberg@ufl.edu) or Sergei Tretiak (serg@lanl.gov) for
permission). For the AMBER input file, refer to <a href="https://ambermd.org/doc12/Amber19.pdf">AMBER-Manual</a>. 
</p>

<p>
The pynasqm input file is written as a commented J-SON file. On lines other than the ones
commented out, the file is white space sensitive. Any edits should be performed
within the second quoted value on the line. Refer to the comments within the
file for guidance on the inputs. Any further question can be referred to Dustin
Tracy (dtracy@ufl.edu).
systems employing the slurm array feature.
</p>

<p>
Once your input files are setup, run the program by executing the following in
your working directory containing the input files.
</p>
<pre class="example" id="org770f93e">
nasqm.py
</pre>
</div>
</div>

<div id="outline-container-org23a00cd" class="outline-3">
<h3 id="org23a00cd"><span class="section-number-3">3.3</span> Plotting an Absorption Spectra</h3>
<div class="outline-text-3" id="text-3-3">
<p>
If the setting <code>run_absorption_collection</code> is set to true, then after the
absorption snapshots are finished, pynasqm will output the average excited state
energies and their corresponding oscillator strengths to a file
<code>spectra_abs.in</code>. The format of <code>spectra_abs.in</code> is
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">S<sub>1</sub>-S<sub>0</sub> energy</td>
<td class="org-left">S<sub>1</sub>-S<sub>0</sub> Oscillator Strength</td>
<td class="org-left">&#x2026;</td>
<td class="org-left">S<sub>n</sub>-S<sub>0</sub> energy</td>
<td class="org-left">S<sub>n</sub>-S<sub>0</sub> Oscillator Strength</td>
</tr>
</tbody>
</table>

<p>
 This can be converted into a gaussian broadened spectra using
the function <code>hist_spectra_lifetime.py</code> which is installed with the installation
of pynasqm. Most included scripts use the python library argparse and will
output a helper with called with the flag <code>--help</code>. The helper for
<code>hist_spectra_lifetime</code> is as follows:
</p>

<div class="org-src-container">
<pre class="src src-shell-script">hist_spectra_lifetime --help


usage: hist_spectra_lifetime.py <span style="color: #51afef;">[</span>-h<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--input INPUT<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--output OUTPUT<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--number_states NUMBER_STATES<span style="color: #51afef;">]</span>
                                <span style="color: #51afef;">[</span>--number_gauss NUMBER_GAUSS<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--fwhm FWHM<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--number_bins NUMBER_BINS<span style="color: #51afef;">]</span>
                                <span style="color: #51afef;">[</span>--xmin XMIN<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--xmax XMAX<span style="color: #51afef;">]</span>

optional arguments:
  -h, --help            show this help message and exit
  --input INPUT, -i INPUT
                        The input file
  --output OUTPUT, -o OUTPUT
                        The output file
  --number_states NUMBER_STATES
                        The number of excited states you want to extract
  --number_gauss NUMBER_GAUSS
                        The number of gaussians
  --fwhm FWHM           Full witdh half max of the broadening <span style="color: #51afef;">(</span>eV<span style="color: #51afef;">)</span>
  --number_bins NUMBER_BINS
                        The number of bins you wish to distribute over
  --xmin XMIN           The minimum energy<span style="color: #51afef;"> in</span> eV
  --xmax XMAX           The maximum energy<span style="color: #51afef;"> in</span> eV
</pre>
</div>

<p>
Our example
</p>
<div class="org-src-container">
<pre class="src src-shell-script">hist_spectra_lifetime.py --number_states 9 <span style="color: #98be65;">\</span>
                         -i spectra_abs.input <span style="color: #98be65;">\</span>
                         -o spectra_abs.out <span style="color: #98be65;">\</span>
                         --xmin 1.5 <span style="color: #98be65;">\</span>
                         --xmax 5 <span style="color: #98be65;">\</span>
                         --number_bins 1000 <span style="color: #98be65;">\</span>
                         --number_gauss 100
</pre>
</div>
<p>
would produce an output <code>spectra_abs.out</code> containing the spectra information in
a format
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Energy (eV)</td>
<td class="org-left">Energy (nm)</td>
<td class="org-left">Absorption S<sub>0</sub>-S<sub>1</sub></td>
<td class="org-left">&#x2026;</td>
<td class="org-left">Absorption S<sub>0</sub>-S<sub>n</sub></td>
</tr>
</tbody>
</table>

<p>
We can plot this file using <code>naesmd_spectra_plotter.py</code>
</p>
<div class="org-src-container">
<pre class="src src-shell-script">usage: naesmd_spectra_plotter.py <span style="color: #51afef;">[</span>-h<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--title TITLE<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--number_states NUMBER_STATES<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--labels LABELS <span style="color: #c678dd;">[</span>LABELS ...<span style="color: #c678dd;">]</span><span style="color: #51afef;">]</span>
                                 <span style="color: #51afef;">[</span>--ylabel YLABEL<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--inputfile INPUTFILE<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--outputfile OUTPUTFILE<span style="color: #51afef;">]</span>
                                 <span style="color: #51afef;">[</span>--letter LETTER<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--comparison COMPARISON<span style="color: #51afef;">]</span> <span style="color: #51afef;">[</span>--x_units X_UNITS<span style="color: #51afef;">]</span>
                                 <span style="color: #51afef;">[</span>--range RANGE <span style="color: #c678dd;">[</span>RANGE ...<span style="color: #c678dd;">]</span><span style="color: #51afef;">]</span>

optional arguments:
  -h, --help            show this help message and exit
  --title TITLE         The title of the graph
  --number_states NUMBER_STATES
                        The number of states you want to include.
  --labels LABELS <span style="color: #51afef;">[</span>LABELS ...<span style="color: #51afef;">]</span>, -l LABELS <span style="color: #51afef;">[</span>LABELS ...<span style="color: #51afef;">]</span>
                        labels of the data
  --ylabel YLABEL       labels for you y axis
  --inputfile INPUTFILE, -i INPUTFILE
                        The input file
  --outputfile OUTPUTFILE, -o OUTPUTFILE
                        The output file
  --letter LETTER       The letter<span style="color: #51afef;"> in</span> the paper
  --comparison COMPARISON, -c COMPARISON
                        Are you comparing spectra?
  --x_units X_UNITS, -x X_UNITS
                        0-Ev or 1-nm
  --range RANGE <span style="color: #51afef;">[</span>RANGE ...<span style="color: #51afef;">]</span>, -r RANGE <span style="color: #51afef;">[</span>RANGE ...<span style="color: #51afef;">]</span>
                        Provide two numbers,the minimum and maximum values<span style="color: #51afef;"> in</span> the units you prefer
</pre>
</div>

<p>
And example could be
</p>
<div class="org-src-container">
<pre class="src src-shell-script">naesmd_spectra_plotter.py <span style="color: #98be65;">\</span>
    -i 0.out <span style="color: #98be65;">\</span>
    -o test.png <span style="color: #98be65;">\</span>
    --title <span style="color: #98be65;">"Test Absorption"</span> <span style="color: #98be65;">\</span>
    --labels S1 S2 S3 S4 S5 S6 <span style="color: #98be65;">\</span>
    --number_states 6 <span style="color: #98be65;">\</span>
    --x_units 0 <span style="color: #98be65;">\</span>
    --range 2.5 4
</pre>
</div>


<div id="orgf9c3c67" class="figure">
<p><img src="./images/abs_test.png" alt="abs_test.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org5586498" class="outline-3">
<h3 id="org5586498"><span class="section-number-3">3.4</span> Plotting Populations</h3>
<div class="outline-text-3" id="text-3-4">
<p>
After running your excited state trajectories with the Tully setting turned on,
you may want to plot the populations of the excited state for analysis. For this
task we can use <code>population_plotter.py</code>
<code>population_plotter.py --help</code>
</p>
<pre class="example">
usage: population_plotter.py [-h] [--pulsepump] [--files FILES [FILES ...]]
			     [--muab_files MUAB_FILES [MUAB_FILES ...]] [--min_energy MIN_ENERGY]
			     [--max_energy MAX_ENERGY] [--min_strength MIN_STRENGTH]

optional arguments:
  -h, --help            show this help message and exit
  --pulsepump           simulating a pulse pump experiment
  --files FILES [FILES ...], -l FILES [FILES ...]
			coeff-n.out files
  --muab_files MUAB_FILES [MUAB_FILES ...]
			the muab files whose energies and oscillators strengths will be used to filter
  --min_energy MIN_ENERGY
			minimum energy differece (ev) from ground state for state S_m
  --max_energy MAX_ENERGY
			maximum energy differece (ev) from ground state for state S_m
  --min_strength MIN_STRENGTH
			minimum oscillator from S1 for state S_m
</pre>

<p>
One of the easier methods that create a list of files would be to export the ls
command of the directories containing the coeffs-n.out files.
</p>

<pre class="example">
export coeffs=`ls {trajs}/{restarts}/coeff*.out`
</pre>

<p>
Then you can generate a table of the containing the populations using
</p>

<pre class="example">
population_plotter --files=$coeffs &gt; pops.out
</pre>

<p>
You could then use any plotting software to looks at the <code>pops.out</code> file. The
<code>pops.out</code> file is formatted as
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Time (fs)</td>
<td class="org-left">Initial State Population</td>
<td class="org-left">Pop S<sub>1</sub></td>
<td class="org-left">&#x2026;</td>
<td class="org-left">Pop S<sub>n</sub></td>
</tr>
</tbody>
</table>

<p>
If you wish to filter the included trajectories using the outputs from the
pulsepump single point trajectories, you can include a list of muab<sub>files</sub> as follows.
Note that now we need to make sure the files are paired with each other, so lets
first copy the files and give each a unique id.
</p>

<pre class="example">
mkdir coeffs
for i in {1...$n_trajs}; do cp qmexcited/traj_$i/restart_0/coeff-n.out coeffs/coeff_$i.out; done
export coeffs=`for i in {1...$n_trajs}; do echo coeffs/coeff_$i.out
mkdir muabs
for i in {1...$n_trajs}; do cp pulsepump/traj_$i/restart_0/muab.out muab/muab_$i.out; done
export muabs=`for i in {1...$n_trajs}; do echo muabs/muab_$i.out
</pre>

<div class="org-src-container">
<pre class="src src-shell-script">population_plotter --files=$<span style="color: #dcaeea;">coeffs</span> <span style="color: #98be65;">\</span>
                   --muab_files=$<span style="color: #dcaeea;">muab_files</span> <span style="color: #98be65;">\</span>
                   --min_energy=1.2 <span style="color: #98be65;">\</span>
                   --max_energy=2.4 <span style="color: #98be65;">\</span>
                   --min_strength=1 &gt; pops.out
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2693876" class="outline-2">
<h2 id="org2693876"><span class="section-number-2">4</span> Tutorials</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org33e2112" class="outline-3">
<h3 id="org33e2112"><span class="section-number-3">4.1</span> PPV3NO2 In Methanol. Absorption and Fluorescence</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Copy the directory tutorials/ppv3no2<sub>in</sub><sub>ch3oh</sub> to a working directory.
cd into the directory.
You should see two xyz files <code>ppv3no.xyz</code> and <code>ch3oh.xyz</code>
You will need to convert these to amber coordinate and parameter files.
</p>

<p>
Run the following to get the prep files needed by t-leap
</p>
<pre class="example">
obabel -ixyz ch3oh.xyz -ogau ch3oh.log &gt; ch3oh.log   
obabel -ixyz ppv3no2.xyz -ogau ppv3no2.log &gt; ppv3no2.log 

antechamber -i ch3oh.log -fi gcrt -o ch3oh.mol2 -fo mol2 -nc 0 -eq 0 -rn ch3oh
antechamber -i ppv3no2.log -fi gcrt -o ppv3no2.mol2 -fo mol2 -nc 0 -eq 0 -rn ppv3no2

parmchk2 -i ch3oh.mol2 -f mol2 -o ch3oh.frcmod
parmchk2 -i ppv3no2.mol2 -f mol2 -o ppv3no2.frcmod
</pre>

<p>
Create the tleap bash script <code>create_box.sh</code>
</p>
<pre class="example">
boxsize=30
solvent=ch3oh
solute=ppv3no2
cat &lt;&lt; EOF &gt; leap.in
source leaprc.gaff
loadamberparams $solute.frcmod
loadamberparams $solvent.frcmod
$solute=loadmol2 $solute.mol2
$solvent=loadmol2 $solvent.mol2
solvatebox $solute $solvent $boxsize
saveamberparm $solute m1.prmtop m1.inpcrd
quit
EOF
tleap -f leap.in
</pre>

<p>
Run with
</p>

<pre class="example">
bash create_box.sh
</pre>

<p>
The Amber parmater file (m1.prmtop) and coordinate file (m1.inpcrd) should have been created.
</p>

<p>
Now equilibrate the system
    Create the following files
    <code>touch m1_min1.in m1_min2.in m1_md1.in m1_md2.in</code>
    For all of these files make sure there's an extra line at the end.
</p>
<div class="org-src-container">
<pre class="src src-shell-script"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">m1_min1.in</span>
initial minimization solvent + ions
&amp;cntrl
  <span style="color: #dcaeea;">imin</span>   = 1,
  <span style="color: #dcaeea;">maxcyc</span> = 1000,
  <span style="color: #dcaeea;">ncyc</span>   = 500,
  <span style="color: #dcaeea;">ntb</span>    = 1,
  <span style="color: #dcaeea;">ntr</span>    = 1,
  <span style="color: #dcaeea;">cut</span>    = 10.0
/
Hold Solute fixed
500.0
ATM 1 &lt;number of solute atoms&gt;
END
END
</pre>
</div>
<p>
Note : The line <code>ATM 1 &lt;number of solute atoms&gt;</code> should be from 1 to Number of atoms in solute.
</p>

<div class="org-src-container">
<pre class="src src-shell-script"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">m1_min2.in</span>
initial minimization solvent + ions
&amp;cntrl
  <span style="color: #dcaeea;">imin</span>   = 1,
  <span style="color: #dcaeea;">maxcyc</span> = 2500,
  <span style="color: #dcaeea;">ncyc</span>   = 1000,
  <span style="color: #dcaeea;">ntb</span>    = 1,
  <span style="color: #dcaeea;">ntr</span>    = 0,
  <span style="color: #dcaeea;">cut</span>    = 10.0
/
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell-script"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">m1_md1.in</span>
MD Equilibration STEP
&amp;cntrl
  <span style="color: #dcaeea;">imin</span>   = 0,
  <span style="color: #dcaeea;">irest</span>  = 0,
  <span style="color: #dcaeea;">ntx</span>    = 1,
  <span style="color: #dcaeea;">ig</span>     =-1,
  <span style="color: #dcaeea;">ntb</span>    = 1,
  <span style="color: #dcaeea;">cut</span>    = 10.0,
  <span style="color: #dcaeea;">ntr</span>    = 1,
  <span style="color: #dcaeea;">ntc</span>    = 2,
  <span style="color: #dcaeea;">ntf</span>    = 2,
  <span style="color: #dcaeea;">tempi</span>  = 0.0,
  <span style="color: #dcaeea;">temp0</span>  = 300.0,
  <span style="color: #dcaeea;">ntt</span>    = 3,
  <span style="color: #dcaeea;">gamma_ln</span> = 2.0,
  <span style="color: #dcaeea;">nstlim</span> = 5000, 
  <span style="color: #dcaeea;">dt</span> = 0.002,
  <span style="color: #dcaeea;">ntpr</span> = 100,
  <span style="color: #dcaeea;">ntwx</span> = 100,
  <span style="color: #dcaeea;">ntwr</span> = 1000
/
Keep fixed with weak restraints
10.0
ATM 1 &lt;number of solute atoms&gt;
END
END
</pre>
</div>
<p>
Note : The line <code>ATM 1 &lt;number of solute atoms&gt;</code> should be from 1 to Number of atoms in solute.
</p>

<div class="org-src-container">
<pre class="src src-shell-script"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">m1_md2.in</span>
Constant Pressure Relaxation
&amp;cntrl
  <span style="color: #dcaeea;">imin</span> = 0, 
  <span style="color: #dcaeea;">irest</span> = 1,
  <span style="color: #dcaeea;">ntx</span> = 5,
  <span style="color: #dcaeea;">ntb</span> = 2,
  <span style="color: #dcaeea;">pres0</span> = 1.0,
  <span style="color: #dcaeea;">ntp</span> = 1,
  <span style="color: #dcaeea;">ig</span> = -1,
  <span style="color: #dcaeea;">taup</span> = 2.0,
  <span style="color: #dcaeea;">cut</span> = 10.0,
  <span style="color: #dcaeea;">ntr</span> = 0,
  <span style="color: #dcaeea;">ntc</span> = 2,
  <span style="color: #dcaeea;">ntf</span> = 2,
  <span style="color: #dcaeea;">tempi</span> = 300.0,
  <span style="color: #dcaeea;">temp0</span> = 300.0,
  <span style="color: #dcaeea;">ntt</span> = 3,
  <span style="color: #dcaeea;">gamma_ln</span> = 2.0,
  <span style="color: #dcaeea;">nstlim</span> = 100000,
  <span style="color: #dcaeea;">dt</span> = 0.002,
  <span style="color: #dcaeea;">ntpr</span> = 100,
  <span style="color: #dcaeea;">ntwx</span> = 100,
  <span style="color: #dcaeea;">ntwv</span> = -1,
  <span style="color: #dcaeea;">ntwr</span> = 1000
/
</pre>
</div>

<p>
Now we want to create our equilibrated system create a file
</p>
<div class="org-src-container">
<pre class="src src-shell-script"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">box_eq.sh</span>
<span style="color: #c678dd;">echo</span> <span style="color: #98be65;">'m1_min1'</span>
sander -O <span style="color: #98be65;">\</span>
   -i m1_min1.in <span style="color: #98be65;">\</span>
   -o m1_min1.out <span style="color: #98be65;">\</span>
   -r m1_min1.rst <span style="color: #98be65;">\</span>
   -c m1.inpcrd <span style="color: #98be65;">\</span>
   -p m1.prmtop <span style="color: #98be65;">\</span>
   -ref m1.inpcrd
<span style="color: #c678dd;">echo</span> <span style="color: #98be65;">'m1_min2'</span>
sander -O <span style="color: #98be65;">\</span>
   -i m1_min2.in <span style="color: #98be65;">\</span>
   -o m1_min2.out <span style="color: #98be65;">\</span>
   -r m1_min2.rst <span style="color: #98be65;">\</span>
   -c m1_min1.rst <span style="color: #98be65;">\</span>
   -p m1.prmtop
<span style="color: #c678dd;">echo</span> <span style="color: #98be65;">'m1_md1'</span>
sander -O <span style="color: #98be65;">\</span>
   -i m1_md1.in <span style="color: #98be65;">\</span>
   -o m1_md1.out <span style="color: #98be65;">\</span>
   -r m1_md1.rst <span style="color: #98be65;">\</span>
   -c m1_min2.rst <span style="color: #98be65;">\</span>
   -p m1.prmtop <span style="color: #98be65;">\</span>
   -ref m1_min2.rst
<span style="color: #c678dd;">echo</span> <span style="color: #98be65;">'m1_md2'</span>
sander -O <span style="color: #98be65;">\</span>
   -i m1_md2.in <span style="color: #98be65;">\</span>
   -o m1_md2.out <span style="color: #98be65;">\</span>
   -r m1_md2.rst <span style="color: #98be65;">\</span>
   -c m1_md1.rst <span style="color: #98be65;">\</span>
   -p m1.prmtop
<span style="color: #c678dd;">echo</span> <span style="color: #98be65;">'finished'</span>
</pre>
</div>
<p>
Note, if you have the pmemd installed, replaced sander with pmemd or pmemd.cuda to
dramatically improve performance. pmemd.cuda requires a GPU.
</p>

<p>
Run this with
</p>
<pre class="example" id="orgcbcbcb4">
bash box_eq.sh
</pre>
<p>
This will leave you with an equilibrated geometry file <code>m1_md2.rst</code>.
</p>

<p>
Running with pmemd, there's a chance you'll receive
<code>ERROR: Calculation halted.  Periodic box dimensions have changed too much from their initial values.</code>
If you receive this error, change <code>box_eq.sh</code> to the following.
</p>
<div class="org-src-container">
<pre class="src src-shell-script">pmemd.cuda -O <span style="color: #98be65;">\</span>
            -i m1_md2.in <span style="color: #98be65;">\</span>
            -o m1_md2.out <span style="color: #98be65;">\</span>
            -r m1_md2.rst <span style="color: #98be65;">\</span>
            -c m1_md2.rst <span style="color: #98be65;">\</span>
            -p m1.prmtop
 <span style="color: #c678dd;">echo</span> <span style="color: #98be65;">'finished'</span>
</pre>
</div>
<p>
Keep running box<sub>eq.sh</sub> until completion.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Dustin Tracy</p>
<p class="date">Created: 2021-04-15 Thu 12:34</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
